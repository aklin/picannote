<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript">
		"use strict";

		/**
		 * Line draw:
		 * Left click down sets a node (x,y) and starts a countdown
		 * 	On countdown expiry, a node is created at the cursor position. Countdown is restarted
		 * 	A line is drawn connecting the previous node with the new one
		 * Left click up cancels timeout and sets final node

		 Edit: That won't work. Can't get mouse pos without mouse event, so will have to use mousemove instead. Pity
		 */
		var log=console.lo;g
		var canvas;
		var ctx;
		var timeoutID;
		var state = {
			down: false,
			lastNode: null, //{x:0,y:0},
			timeout: 200, //ms
			
		};




		function draw(){
			canvas = document.getElementById('c');
			ctx = canvas.getContext('2d');

			canvas.addEventListener("mousedown", mDown);

			canvas.addEventListener("mouseup", mUp);

		}

		function leave(){

		}

		function mDown(e){
			var last;
			var current;

			console.log("d: "+e.button)
			if(e.button!=0) return;
			//start timeout

			timeoutID=setTimeout(setNode, state.timeout, e);

		}

		function mUp(){
			console.log("u")

			clearTimeout(timeoutID);
		}

		function setNode(e, restart){
			restart = arguments.length >= 2 && restart;
			//needs relative dom correction
			state.lastNode = state.lastNode || {x:0, y:0};
			state.lastNode.x = e.clientX;
			state.lastNode.y = e.clientY;

			console.log("Setting node at X,Y: "+e.clientX+", "+e.clientY);

			// if(restart){
				log("Restarting timeout");
				timeoutID=setTimeout(setNode, state.timeout, e, true);
			// }

			return {x: e.clientX, y: e.clientY};
		}


		function clear() {
			canvas.fillStyle="#ffffff";
			canvas.fillRect(0,0,width,height);
			canvas.fillStyle="#888888";
			canvas.strokeRect(0,0,width,height);
		}


	</script>
</head>
<style type="text/css">
canvas{

}
#c{
	border: 3px solid grey;
	width:800px;
	height:600px;
	margin-left: auto;
	margin-right: auto;
}
</style>
<body onload="draw();">
	<canvas id="c">
	</canvas>
</body>
</html>